<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sally&#39;s Flower Shop - Part 6 | Backend Technical Consultant Onboarding (BTCO)</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Exercises, codes and solutions for the BTCO training program">
    
    <link rel="preload" href="/psae-btco/assets/css/0.styles.ae6c4b4b.css" as="style"><link rel="preload" href="/psae-btco/assets/js/app.d63afb61.js" as="script"><link rel="preload" href="/psae-btco/assets/js/2.3969ddc5.js" as="script"><link rel="preload" href="/psae-btco/assets/js/12.9b295f8f.js" as="script"><link rel="preload" href="/psae-btco/assets/js/5.6d5f03cc.js" as="script"><link rel="prefetch" href="/psae-btco/assets/js/10.5bcde458.js"><link rel="prefetch" href="/psae-btco/assets/js/11.cf8f5c7a.js"><link rel="prefetch" href="/psae-btco/assets/js/13.0fc82dc5.js"><link rel="prefetch" href="/psae-btco/assets/js/14.2e0c10cb.js"><link rel="prefetch" href="/psae-btco/assets/js/15.c65f983f.js"><link rel="prefetch" href="/psae-btco/assets/js/16.89195d07.js"><link rel="prefetch" href="/psae-btco/assets/js/17.1a7e901b.js"><link rel="prefetch" href="/psae-btco/assets/js/18.d0f79296.js"><link rel="prefetch" href="/psae-btco/assets/js/19.e238475a.js"><link rel="prefetch" href="/psae-btco/assets/js/20.c1014938.js"><link rel="prefetch" href="/psae-btco/assets/js/21.88562d51.js"><link rel="prefetch" href="/psae-btco/assets/js/22.550cd687.js"><link rel="prefetch" href="/psae-btco/assets/js/23.65c8ca17.js"><link rel="prefetch" href="/psae-btco/assets/js/24.7fd49ae9.js"><link rel="prefetch" href="/psae-btco/assets/js/25.2466cc21.js"><link rel="prefetch" href="/psae-btco/assets/js/26.0896e2ab.js"><link rel="prefetch" href="/psae-btco/assets/js/27.137735d7.js"><link rel="prefetch" href="/psae-btco/assets/js/28.0a0cdb1a.js"><link rel="prefetch" href="/psae-btco/assets/js/29.d6730b7b.js"><link rel="prefetch" href="/psae-btco/assets/js/3.7f90f6a6.js"><link rel="prefetch" href="/psae-btco/assets/js/30.3a3765e2.js"><link rel="prefetch" href="/psae-btco/assets/js/4.bcf7b13f.js"><link rel="prefetch" href="/psae-btco/assets/js/6.3ab397f0.js"><link rel="prefetch" href="/psae-btco/assets/js/7.a39ec6a2.js"><link rel="prefetch" href="/psae-btco/assets/js/8.87f68678.js"><link rel="prefetch" href="/psae-btco/assets/js/9.d1355fc0.js">
    <link rel="stylesheet" href="/psae-btco/assets/css/0.styles.ae6c4b4b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/psae-btco/" class="home-link router-link-active"><!----> <span class="site-name">Backend Technical Consultant Onboarding (BTCO)</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/psae-btco/" aria-current="page" class="sidebar-link">Howdy Partner</a></li><li><section class="sidebar-group depth-0"><a href="/psae-btco/" class="sidebar-heading clickable router-link-active"><span>Exercises</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/psae-btco/" class="sidebar-heading clickable router-link-active open"><span>Sally's Flower Shop</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/psae-btco/exercises/flower_shop.html" class="sidebar-link">Part 1</a></li><li><a href="/psae-btco/exercises/flower_shop_2.html" class="sidebar-link">Part 2</a></li><li><a href="/psae-btco/exercises/flower_shop_3.html" class="sidebar-link">Part 3</a></li><li><a href="/psae-btco/exercises/flower_shop_4.html" class="sidebar-link">Part 4</a></li><li><a href="/psae-btco/exercises/flower_shop_5.html" class="sidebar-link">Part 5</a></li><li><a href="/psae-btco/exercises/flower_shop_6.html" class="sidebar-link">Part 6</a></li><li><a href="/psae-btco/exercises/flower_shop_7.html" class="sidebar-link">Part 7</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/psae-btco/" class="sidebar-heading clickable router-link-active"><span>Awesome School</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/psae-btco/" class="sidebar-heading clickable router-link-active"><span>Realty Management</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/psae-btco/" class="sidebar-heading clickable router-link-active open"><span>Solutions</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/psae-btco/" class="sidebar-heading clickable router-link-active open"><span>Sally's Flower Shop</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/psae-btco/solutions/flower_shop.html" class="sidebar-link">Part 1</a></li><li><a href="/psae-btco/solutions/flower_shop_2.html" class="sidebar-link">Part 2</a></li><li><a href="/psae-btco/solutions/flower_shop_3.html" class="sidebar-link">Part 3</a></li><li><a href="/psae-btco/solutions/flower_shop_4.html" class="sidebar-link">Part 4</a></li><li><a href="/psae-btco/solutions/flower_shop_5.html" class="sidebar-link">Part 5</a></li><li><a href="/psae-btco/solutions/flower_shop_6.html" aria-current="page" class="active sidebar-link">Part 6</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/psae-btco/solutions/flower_shop_7.html" class="sidebar-link">Part 7</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sally-s-flower-shop-part-6"><a href="#sally-s-flower-shop-part-6" class="header-anchor">#</a> Sally's Flower Shop - Part 6</h1> <p><a href="https://github.com/odoo-ps/psae-btco/commit/7aa392f04e7927708b26026e898894a6afb19a62" target="_blank" rel="noopener noreferrer">View the commit for this solution<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>This exercise emphasizes
on <a href="https://www.odoo.com/documentation/16.0/developer/reference/backend/security.html" target="_blank" rel="noopener noreferrer">security<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in
terms of groups and record rules, and a special model in Odoo called <code>ir.sequence</code>.</p> <h3 id="groups"><a href="#groups" class="header-anchor">#</a> Groups</h3> <p>We will create a
gardeners' <a href="https://www.odoo.com/documentation/16.0/developer/reference/backend/security.html#res.groups" target="_blank" rel="noopener noreferrer">group<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in a
dedicated file named <code>groups.xml</code> inside the <code>data</code> folder. It is possible to create subgroups by
specifying the <code>implied_ids</code> field. We can think of this field as <em>parent groups</em> so that our group will inherit all
of their access rights. However, we will not need to create a subgroup for now. Moreover, the new group record is
wrapped by a <code>data</code> tag that has the attribute <code>noupdate=&quot;1&quot;</code>. Such records will never be updated when we upgrade the
module; they will only be created when installing the module. This is a good practice when we do not want to
reset certain records during a module upgrade and rather keep the changes done on them by the user. Examples may include
groups, record rules, any demo data, and more.</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>odoo</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">noupdate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span> <span class="token attr-name">model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>res.groups<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>odoo</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div style="display:inline-flex;margin-bottom:12px;" data-v-37099482><button data-v-37099482><div data-v-37099482>View Code</div></button></div> <h3 id="scheduled-action"><a href="#scheduled-action" class="header-anchor">#</a> Scheduled Action</h3> <p>The relationship between products and serials is that a <code>product.product</code> record has many <code>stock.production.lot</code> (this
is the model for serial) records. We need to check all the serials for each flower product and if at
least one serial requires watering, then the product will be marked with a ribbon. Now, one may think of implementing
this by a computed boolean field in the <code>product.product</code> model and the compute method can have a dependency on the
serial records. Regardless of whether you considered this approach, it cannot be done unfortunately because of the
following:</p> <ul><li>there is no reference to <code>stock.production.lot</code> (serial) records from the product, rather there is product reference
in the serial model</li> <li>even if there was a serial reference, the aforementioned compute method needs to be triggered based on the serial
records as well as the
<strong>current date</strong> since we need to check if any serial needs watering every single day</li></ul> <p>As a rule of thumb, whenever something needs to be checked over fixed time intervals, it calls for
a <a href="https://www.odoo.com/documentation/16.0/developer/reference/backend/actions.html#automated-actions-ir-cron" target="_blank" rel="noopener noreferrer">scheduled or automated action<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
We will create a scheduled action that will run some Python code every day. To write our code, we select the <code>state</code>
field to be <code>code</code> and in the <code>code</code> field, we make a call to a model's function.</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>odoo</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span> <span class="token attr-name">model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ir.cron<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>state<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>code<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>model.action_needs_watering()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>odoo</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div style="display:inline-flex;margin-bottom:12px;" data-v-37099482><button data-v-37099482><div data-v-37099482>View Code</div></button></div> <p>Notice that <code>model</code> is a variable available within the scope of the <code>code</code> field. The variable contains reference to the model to which this action is bound.
Below is the full list of variables available for use and they were copied from the form view of <code>ir.actions.server</code>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Available variables:</span>
<span class="token comment">#  - env: Odoo Environment on which the action is triggered</span>
<span class="token comment">#  - model: Odoo Model of the record on which the action is triggered; is a void recordset</span>
<span class="token comment">#  - record: record on which the action is triggered; may be void</span>
<span class="token comment">#  - records: recordset of all records on which the action is triggered in multi-mode; may be void</span>
<span class="token comment">#  - time, datetime, dateutil, timezone: useful Python libraries</span>
<span class="token comment">#  - float_compare: Odoo function to compare floats based on specific precisions</span>
<span class="token comment">#  - log: log(message, level='info'): logging function to record debug information in ir.logging table</span>
<span class="token comment">#  - UserError: Warning Exception to use with raise</span>
<span class="token comment">#  - Command: x2Many commands namespace</span>
<span class="token comment"># To return an action, assign: action = {...}</span>
</code></pre></div><p>In the function, we fetch all the flower products in the database then retrieve all the serial records that belong to
the flower products. Next, for each serial we calculate the number of days it has been since the last time it was
watered. This is then compared to <code>watering_frequency</code> of the flower to determine if it needs watering. We also use
a <code>defaultdict</code> dictionary where the keys are flower product IDs and the values can be either <code>True</code> if the product
needs watering, or <code>False</code> otherwise. Once we iterate over all the serials, we update the product records.</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token keyword">def</span> <span class="token function">action_needs_watering</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    flowers <span class="token operator">=</span> self<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">&quot;product.product&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&quot;is_flower&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;=&quot;</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    serials <span class="token operator">=</span> self<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">&quot;stock.production.lot&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&quot;product_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;in&quot;</span><span class="token punctuation">,</span> flowers<span class="token punctuation">.</span>ids<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    lot_vals <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> serial <span class="token keyword">in</span> serials<span class="token punctuation">:</span>
        <span class="token keyword">if</span> serial<span class="token punctuation">.</span>water_ids<span class="token punctuation">:</span>
            last_watered_date <span class="token operator">=</span> serial<span class="token punctuation">.</span>water_ids<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>date
            frequency <span class="token operator">=</span> serial<span class="token punctuation">.</span>product_id<span class="token punctuation">.</span>flower_id<span class="token punctuation">.</span>watering_frequency
            today <span class="token operator">=</span> fields<span class="token punctuation">.</span>Date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span>
            needs_watering <span class="token operator">=</span> <span class="token punctuation">(</span>today <span class="token operator">-</span> last_watered_date<span class="token punctuation">)</span><span class="token punctuation">.</span>days <span class="token operator">&gt;=</span> frequency
            lot_vals<span class="token punctuation">[</span>serial<span class="token punctuation">.</span>product_id<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">]</span> <span class="token operator">|</span><span class="token operator">=</span> needs_watering
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            lot_vals<span class="token punctuation">[</span>serial<span class="token punctuation">.</span>product_id<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">for</span> flower <span class="token keyword">in</span> flowers<span class="token punctuation">:</span>
        flower<span class="token punctuation">.</span>needs_watering <span class="token operator">=</span> lot_vals<span class="token punctuation">[</span>flower<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">]</span>
</code></pre></div><div style="display:inline-flex;margin-bottom:12px;" data-v-37099482><button data-v-37099482><div data-v-37099482>View Code</div></button></div> <h3 id="sequence"><a href="#sequence" class="header-anchor">#</a> Sequence</h3> <p>If all the flower serials followed the same sequence numbering, we would have simply created an <code>ir.sequence</code> record in
XML and called it a day. However, the exercise requires that each flower should have its own sequence record. Hence, we
will add a <code>many2one</code> field in the <code>product.product</code> model so that each product record can be associated to
an <code>ir.sequence</code> record.</p> <div class="language-python extra-class"><pre class="language-python"><code>sequence_id <span class="token operator">=</span> fields<span class="token punctuation">.</span>Many2one<span class="token punctuation">(</span><span class="token string">&quot;ir.sequence&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Flower Sequence&quot;</span><span class="token punctuation">)</span>
</code></pre></div><div style="display:inline-flex;margin-bottom:12px;" data-v-37099482><button data-v-37099482><div data-v-37099482>View Code</div></button></div> <p>Next, in the <code>create</code> method of <code>stock.production.lot</code>, we will call <code>next_by_id()</code> on the product's sequence record.
This will return the next appropriate sequence number for the serial that is being created. We then assign the sequence
inside <code>vals</code> to the <code>name</code> field of the serial.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@api<span class="token punctuation">.</span>model_create_multi</span>
<span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vals_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> vals <span class="token keyword">in</span> vals_list<span class="token punctuation">:</span>
        product <span class="token operator">=</span> self<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">&quot;product.product&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>browse<span class="token punctuation">(</span>vals<span class="token punctuation">[</span><span class="token string">&quot;product_id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> product<span class="token punctuation">.</span>sequence_id<span class="token punctuation">:</span>
            vals<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> product<span class="token punctuation">.</span>sequence_id<span class="token punctuation">.</span>next_by_id<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>create<span class="token punctuation">(</span>vals_list<span class="token punctuation">)</span>
</code></pre></div><div style="display:inline-flex;margin-bottom:12px;" data-v-37099482><button data-v-37099482><div data-v-37099482>View Code</div></button></div> <h3 id="multi-record-creation"><a href="#multi-record-creation" class="header-anchor">#</a> Multi-Record Creation</h3> <p>In the previous code snippet, we observe that the create method has the function decorator <code>model_create_multi</code>. This is
a common decorator used in Odoo to indicate that the method is able to create multiple records at the same time. The
main difference between having this decorator and the decorator <code>model</code> is that the former accepts a <em>list of
dictionaries</em> whereas the latter accepts a single <em>dictionary</em>. This also explains why we had to
use a loop in our create method to iterate over <code>vals_list</code>. Furthermore, the original <code>stock.production.lot</code> model
allows multi-record creation and since we are overriding its create method for our use, we must remain consistent with
the decorator type.</p> <p>If we inspect the values parameter (can be <code>vals</code> or <code>vals_list</code>, name does not matter), that is being passed to the
create method, below are how their contents would look
like.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># multi-record using @api.model_create_multi</span>
vals <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ABC123&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;product_id&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string">&quot;quantity&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;XYZ321&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;product_id&quot;</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token string">&quot;quantity&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>

<span class="token comment"># single record using @api.model</span>
vals <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;JKL456&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;product_id&quot;</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token string">&quot;quantity&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="record-rules"><a href="#record-rules" class="header-anchor">#</a> Record Rules</h3> <p><a href="https://www.odoo.com/documentation/16.0/developer/howtos/rdtraining/B_acl_irrules.html#record-rules" target="_blank" rel="noopener noreferrer">Record rules<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> are
one of the trickiest topics in Odoo. There are two types of record rules: global rules and group-specific rules. The
following is copied from the form view of <code>ir.rule</code> and will be important in solving the exercise:</p> <p><em>Global rules (non group-specific) are restrictions, and cannot be bypassed.
Group-specific rules grant additional permissions, but are constrained within the bounds of global ones.</em></p> <p>Moreover, these are how the interactions go about between global and group-specific rules:</p> <ol><li>Global rules are ANDed with each other</li> <li>Group-specific rules are ORed with each other</li> <li>Global rules and the result of group-specific rules are ANDed with each other</li></ol> <p>Example: GLOBAL_RULE_1 AND GLOBAL_RULE_2 AND ( (GROUP_A_RULE_1 OR GROUP_A_RULE_2) OR (GROUP_B_RULE_1 OR
GROUP_B_RULE_2) )</p> <p>For this exercise, first we will create a global rule that basically translates to this:</p> <p><em>Give access to all products if the user belongs to the gardeners' group, otherwise give access to non-flower products
only.</em></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>odoo</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">noupdate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span> <span class="token attr-name">model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ir.rule<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            ...
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>domain_force<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>[(1,'=',1)] if user.user_has_groups('flower_shop.group_gardener') else
                [('is_flower','=',False)]
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>odoo</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div style="display:inline-flex;margin-bottom:12px;" data-v-37099482><button data-v-37099482><div data-v-37099482>View Code</div></button></div> <p>With this record rule, any gardener can access any flower product. We now want to restrict one's access further by
creating another record rule that says:</p> <p><em>For a gardener user, show them flowers that either have no gardeners assigned or have the current user assigned.</em></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>odoo</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">noupdate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span> <span class="token attr-name">model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ir.rule<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            ...
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>groups<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[(4, ref(<span class="token punctuation">'</span>flower_shop.group_gardener<span class="token punctuation">'</span>))]<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>domain_force<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>['|',('user_ids','=',False),('user_ids','in',user.id)]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>odoo</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div style="display:inline-flex;margin-bottom:12px;" data-v-37099482><button data-v-37099482><div data-v-37099482>View Code</div></button></div> <p>Note that this record rule applies only on the gardeners' group. While the global rule earlier allowed access to all
flower products, this group-specific rule narrows down the access instead. As a result, a user belonging to the
gardener's group will see flower products that they are assigned to and the products that do not have anybody assigned.</p> <p>The result of the record rules can be depicted by the Venn diagram.
<br></p><div style="text-align:center;"><img src="/psae-btco/assets/img/record-rules-venn-diagram.ba042dc8.png" width="550"></div> <br>
This marks the completion of part 6 of the case study.<p></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/psae-btco/solutions/flower_shop_5.html" class="prev">
        Part 5
      </a></span> <span class="next"><a href="/psae-btco/solutions/flower_shop_7.html">
        Part 7
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/psae-btco/assets/js/app.d63afb61.js" defer></script><script src="/psae-btco/assets/js/2.3969ddc5.js" defer></script><script src="/psae-btco/assets/js/12.9b295f8f.js" defer></script><script src="/psae-btco/assets/js/5.6d5f03cc.js" defer></script>
  </body>
</html>
