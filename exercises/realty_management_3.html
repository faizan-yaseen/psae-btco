<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Realty Management - Part 3 | Backend Technical Consultant Onboarding (BTCO)</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Exercises, codes and solutions for the BTCO training program">
    
    <link rel="preload" href="/psae-btco/assets/css/0.styles.ae6c4b4b.css" as="style"><link rel="preload" href="/psae-btco/assets/js/app.d63afb61.js" as="script"><link rel="preload" href="/psae-btco/assets/js/2.3969ddc5.js" as="script"><link rel="preload" href="/psae-btco/assets/js/28.0a0cdb1a.js" as="script"><link rel="prefetch" href="/psae-btco/assets/js/10.5bcde458.js"><link rel="prefetch" href="/psae-btco/assets/js/11.cf8f5c7a.js"><link rel="prefetch" href="/psae-btco/assets/js/12.9b295f8f.js"><link rel="prefetch" href="/psae-btco/assets/js/13.0fc82dc5.js"><link rel="prefetch" href="/psae-btco/assets/js/14.2e0c10cb.js"><link rel="prefetch" href="/psae-btco/assets/js/15.c65f983f.js"><link rel="prefetch" href="/psae-btco/assets/js/16.89195d07.js"><link rel="prefetch" href="/psae-btco/assets/js/17.1a7e901b.js"><link rel="prefetch" href="/psae-btco/assets/js/18.d0f79296.js"><link rel="prefetch" href="/psae-btco/assets/js/19.e238475a.js"><link rel="prefetch" href="/psae-btco/assets/js/20.c1014938.js"><link rel="prefetch" href="/psae-btco/assets/js/21.88562d51.js"><link rel="prefetch" href="/psae-btco/assets/js/22.550cd687.js"><link rel="prefetch" href="/psae-btco/assets/js/23.65c8ca17.js"><link rel="prefetch" href="/psae-btco/assets/js/24.7fd49ae9.js"><link rel="prefetch" href="/psae-btco/assets/js/25.2466cc21.js"><link rel="prefetch" href="/psae-btco/assets/js/26.0896e2ab.js"><link rel="prefetch" href="/psae-btco/assets/js/27.137735d7.js"><link rel="prefetch" href="/psae-btco/assets/js/29.d6730b7b.js"><link rel="prefetch" href="/psae-btco/assets/js/3.7f90f6a6.js"><link rel="prefetch" href="/psae-btco/assets/js/30.3a3765e2.js"><link rel="prefetch" href="/psae-btco/assets/js/4.bcf7b13f.js"><link rel="prefetch" href="/psae-btco/assets/js/5.6d5f03cc.js"><link rel="prefetch" href="/psae-btco/assets/js/6.3ab397f0.js"><link rel="prefetch" href="/psae-btco/assets/js/7.a39ec6a2.js"><link rel="prefetch" href="/psae-btco/assets/js/8.87f68678.js"><link rel="prefetch" href="/psae-btco/assets/js/9.d1355fc0.js">
    <link rel="stylesheet" href="/psae-btco/assets/css/0.styles.ae6c4b4b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/psae-btco/" class="home-link router-link-active"><!----> <span class="site-name">Backend Technical Consultant Onboarding (BTCO)</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/psae-btco/" aria-current="page" class="sidebar-link">Howdy Partner</a></li><li><section class="sidebar-group depth-0"><a href="/psae-btco/" class="sidebar-heading clickable router-link-active open"><span>Exercises</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/psae-btco/" class="sidebar-heading clickable router-link-active"><span>Sally's Flower Shop</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/psae-btco/" class="sidebar-heading clickable router-link-active"><span>Awesome School</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/psae-btco/" class="sidebar-heading clickable router-link-active open"><span>Realty Management</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/psae-btco/exercises/realty_management.html" class="sidebar-link">Part 1</a></li><li><a href="/psae-btco/exercises/realty_management_2.html" class="sidebar-link">Part 2</a></li><li><a href="/psae-btco/exercises/realty_management_3.html" aria-current="page" class="active sidebar-link">Part 3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/psae-btco/exercises/realty_management_3.html#new-security-groups" class="sidebar-link">New Security Groups</a></li><li class="sidebar-sub-header"><a href="/psae-btco/exercises/realty_management_3.html#only-tenancy-managers-can-confirm-tenancies" class="sidebar-link">Only Tenancy Managers can Confirm Tenancies</a></li><li class="sidebar-sub-header"><a href="/psae-btco/exercises/realty_management_3.html#tenancy-agents-can-only-see-their-own-tenancies" class="sidebar-link">Tenancy Agents can only see their own Tenancies</a></li><li class="sidebar-sub-header"><a href="/psae-btco/exercises/realty_management_3.html#define-a-sequence-for-tenancies" class="sidebar-link">Define a Sequence for Tenancies</a></li><li class="sidebar-sub-header"><a href="/psae-btco/exercises/realty_management_3.html#new-report-for-tenancies" class="sidebar-link">New Report for Tenancies</a></li><li class="sidebar-sub-header"><a href="/psae-btco/exercises/realty_management_3.html#make-properties-visible-on-the-website" class="sidebar-link">Make Properties Visible on the Website</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/psae-btco/" class="sidebar-heading clickable router-link-active"><span>Solutions</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/psae-btco/" class="sidebar-heading clickable router-link-active open"><span>Sally's Flower Shop</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/psae-btco/solutions/flower_shop.html" class="sidebar-link">Part 1</a></li><li><a href="/psae-btco/solutions/flower_shop_2.html" class="sidebar-link">Part 2</a></li><li><a href="/psae-btco/solutions/flower_shop_3.html" class="sidebar-link">Part 3</a></li><li><a href="/psae-btco/solutions/flower_shop_4.html" class="sidebar-link">Part 4</a></li><li><a href="/psae-btco/solutions/flower_shop_5.html" class="sidebar-link">Part 5</a></li><li><a href="/psae-btco/solutions/flower_shop_6.html" class="sidebar-link">Part 6</a></li><li><a href="/psae-btco/solutions/flower_shop_7.html" class="sidebar-link">Part 7</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="realty-management-part-3"><a href="#realty-management-part-3" class="header-anchor">#</a> Realty Management - Part 3</h1> <p>Part 1: <a href="/psae-btco/exercises/realty_management.html">Realty Management - Part 1</a>
Part 2: <a href="/psae-btco/exercises/realty_management_2.html">Realty Management - Part 2</a></p> <p>The realty agency has come back to your company one last time to improve the security of their application:</p> <h2 id="new-security-groups"><a href="#new-security-groups" class="header-anchor">#</a> New Security Groups</h2> <p>To better manage the responsibilities and permissions of their employees, the agency wants to separate their system users
into three new groups: Property Managers, Tenancy Managers &amp; Tenancy Agents.</p> <p>Property Managers can read, write, create and unlink both Properties &amp; Tenancies.
Tenancy Managers and Tenancy Agents are only able to read, write, create and unlink Tenancies.</p> <p>These new groups should be grouped under a new <strong>Realty Management</strong> category.</p> <p><strong>Hint:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>&lt; CREATE CATEGORY &gt;
&lt;record id='&lt;CATEGORY_ID&gt;' model='ir.module.category'&gt;
    &lt;field name='name'&gt;Realty Management&lt;/field&gt;
        ...
&lt;/record&gt;

&lt; CREATE GROUPS &gt;
&lt;record id='&lt;GROUP_1_ID&gt;' model='res.groups'&gt;
    &lt;field name='name'&gt;Tenancy Managers&lt;/field&gt;
    &lt;field name='category_id' ref='&lt;MODULE_NAME&gt;.&lt;CATEGORY_ID&gt;' /&gt;
        ...
&lt;/record&gt;

&lt;record id='&lt;GROUP_2_ID&gt;' model='res.groups'&gt;
    &lt;field name='name'&gt;Tenancy Agents&lt;/field&gt;
    &lt;field name='category_id' ref='&lt;MODULE_NAME&gt;.&lt;CATEGORY_ID&gt;' /&gt;
        ...
&lt;/record&gt;

&lt;record id='&lt;GROUP_3_ID&gt;' model='res.groups'&gt;
    &lt;field name='name'&gt;Property Managers&lt;/field&gt;
    &lt;field name='category_id' ref='&lt;MODULE_NAME&gt;.&lt;CATEGORY_ID&gt;' /&gt;
    &lt;field name='implied_ids' ref='...' /&gt;
        ...
&lt;/record&gt;

&lt; UPDATE ACCESS RIGHTS &gt;
Update the ir.model.access.csv file in your security folder to use the correct groups.

</code></pre></div><h2 id="only-tenancy-managers-can-confirm-tenancies"><a href="#only-tenancy-managers-can-confirm-tenancies" class="header-anchor">#</a> Only Tenancy Managers can Confirm Tenancies</h2> <p>The agency wants only Tenancy Managers, and by extension property managers, to be able to validate tenancies.
To achieve this, define a new view that inherits the base tenancy form view and make the <strong>Confirm</strong> button only
visible to users with the correct group.</p> <p><strong>Hint:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>&lt; INHERIT THE FORM VIEW &gt;
&lt;record id='&lt;CUSTOM_ID&gt;' model='ir.ui.view'&gt;
    ...
    &lt;field name='inherit_id' ref='&lt;MODULE_NAME&gt;.&lt;INITIAL_FORM_VIEW&gt;' /&gt;
    &lt;field name='groups_id' eval='[(4, ref(&quot;&lt;MODULE_NAME&gt;.&lt;GROUP_ID&gt;&quot;))]'/&gt;
    ...
&lt;/record&gt;
</code></pre></div><p>It is also recommended to add a check on the python side to make sure Tenancies can only be validated by the correct group. To achieve this, use the following function available on any user record to check their groups:</p> <div class="language- extra-class"><pre class="language-text"><code>from odoo.exceptions import UserError
...
if not user.has_group('&lt;MODULE_NAME&gt;.&lt;GROUP_ID&gt;'):
    raise UserError('...')
...
</code></pre></div><h2 id="tenancy-agents-can-only-see-their-own-tenancies"><a href="#tenancy-agents-can-only-see-their-own-tenancies" class="header-anchor">#</a> Tenancy Agents can only see their own Tenancies</h2> <p>To implement further security, the agency wishes to allow Tenancy Agents to only be able to view, write, create and unlink their own tenancies.</p> <p>To achieve this, add a new field on the Tenancy model, where a user can be specified. By default, the value of the field
should be <code>this.env.user</code>, and only Tenancy Managers can change its value.</p> <p>Once the field has been added, create new record rules to limit the access on the Tenancy Model.</p> <p><strong>Hint:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>&lt; ADD A NEW FIELD TO THE TENANCY MODEL &gt;
...
user_id = fields.Many2one(&quot;res.users&quot;, string=&quot;Agent&quot;, default=lambda self: self.env.user)
...

&lt; CREATE THE RECORD RULE &gt;
&lt;record id='&lt;CUSTOM_ID&gt;' model='ir.rule'&gt;
    &lt;field name='name'&gt;Tenancies: Agents can only manage their own tenancies&lt;/field&gt;
    &lt;field name='model_id' ref='model_realty_tenancy' /&gt;
    &lt;field name='domain_force'&gt;[('user_id', '=', user.id)]&lt;/field&gt;
    &lt;field name='groups' eval='...' /&gt;
    ...
        Set then permissions
    ...
&lt;/record&gt;
</code></pre></div><h2 id="define-a-sequence-for-tenancies"><a href="#define-a-sequence-for-tenancies" class="header-anchor">#</a> Define a Sequence for Tenancies</h2> <p>To implement a better, more scalable naming convention for your tenancies, the agency wishes to define a new
sequence that will be used to name your tenancies automatically.</p> <p>To achieve this, define a new <code>ir.sequence</code> record and use it to initialize the name of your tenancy.</p> <p><strong>Hint:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>&lt; ADD A NEW SEQUENCE &gt;
&lt;record id='&lt;CUSTOM_ID&gt;' model='ir.sequence'&gt;
    &lt;field name='name'&gt;Realty Tenancy&lt;/field&gt;
    &lt;field name='code'&gt;tenancy.sequence&lt;/field&gt;
    &lt;field name='prefix'&gt;TEN/%(year)s/&lt;/field&gt;
    &lt;field name='padding' eval='...' /&gt;
    ...
&lt;/record&gt;

&lt; OVERRIDE THE NAME FIELD. IT SHOULD NOT BE COMPUTED, AND ITS DEFAULT VALUE SHOULD BE '/'&gt;

&lt; OVERRIDE THE CONFIRM METHOD &gt;

def action_confirm(self, vals_list)
    ...
    self.name = self.env.ref('&lt;MODULE_NAME&gt;.&lt;SEQUENCE_ID&gt;').next_by_id()
    # OR
    self.name = self.env['ir.sequence'].next_by_code('realty.tenancy')
    ...
</code></pre></div><h2 id="new-report-for-tenancies"><a href="#new-report-for-tenancies" class="header-anchor">#</a> New Report for Tenancies</h2> <p>The agency wants to be able to print a document with the details of any given tenancy(ies).
To achieve this, create a new pdf report for the Tenancies model. The report should display all relevant information
about the tenancy.</p> <p>If the tenancy is ongoing, the title of the report should be displayed in green.
If the tenancy is still in draft, the title of the report should be: 'Draft Tenancy' in gray.
If the tenancy is neither ongoing nor in draft, the title should be displayed in blue.</p> <p>Print whatever information you think is pertinent, including the tenants, rents and dates.</p> <p>You can check the Invoice report defined in <code>odoo/addons/account/views/report_invoice.xml</code> to get an idea of what
your report should look like. No need to be as complex, however. Keep it simple.</p> <p><strong>Hint:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>&lt; DEFINE A NEW REPORT ACTION &gt;
&lt;record id='&lt;CUSTOM_ID&gt;' model='ir.actions.report'&gt;
    ...
    &lt;field name='report_name'&gt;&lt;MODULE_NAME&gt;.tenancy_contract&lt;/field&gt;
    &lt;field name='report_file'&gt;&lt;MODULE_NAME&gt;.tenancy_contract&lt;/field&gt;
    ...
&lt;/record&gt;

&lt; DEFINE A NEW QWEB TEMPLATE FOR YOUR REPORT &gt;
&lt;template id=&quot;tenancy_contract&quot;&gt;
    &lt;t t-call=&quot;web.html_container&quot;&gt;
        &lt;t t-foreach=&quot;docs&quot; t-as=&quot;o&quot;&gt;
            &lt;t t-call=&quot;web.external_layout&quot;&gt;
                &lt;div class=&quot;page&quot;&gt;

                    Define the architecture of your report.

                    You can use Bootstrap css classes to customize the look &amp; feel.
                    For example: To change the color of a paragraph, use text-success, text-info and so on.

                &lt;/div&gt;
            &lt;/t&gt;
        &lt;/t&gt;
    &lt;/t&gt;
&lt;/template&gt;

</code></pre></div><h2 id="make-properties-visible-on-the-website"><a href="#make-properties-visible-on-the-website" class="header-anchor">#</a> Make Properties Visible on the Website</h2> <p>The agency wishes to make their properties accessible via the website.</p> <p>To achieve this, create a new controller with the following route <code>/properties/&lt;int:property_id&gt;</code>, the route method should take a <code>property_id</code> parameter, that will be used to look-up a Property record through the ORM, then render it in a custom QWEB template.
The web page should at least render the Property's name and any other information you may think is pertinent.</p> <p><strong>Hint:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>&lt; DEFINE A NEW CONTROLLER &gt;

class RealtyController(...):

@route(...)
def property_view(...)
    ...
    return request.render(&lt;TEMPLATE_ID&gt;, qcontext={...})

&lt; DEFINE A NEW QWEB TEMPLATE &gt;
&lt;template id=&quot;&lt;TEMPLATE_ID&gt;&quot;&gt;
    &lt;t t-call=&quot;website.layout&quot;&gt;
        &lt;t t-set=&quot;pageName&quot; t-value=&quot;'homepage'&quot;/&gt;
        &lt;div id=&quot;wrap&quot;&gt;
            ...
        &lt;/div&gt;
    &lt;/t&gt;
&lt;/template&gt;

</code></pre></div><p>Once the controller and page are set up, add a button on the Property form view that redirects to the route of the controller and allows the users to view the property on the website.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/psae-btco/exercises/realty_management_2.html" class="prev">
        Part 2
      </a></span> <span class="next"><a href="/psae-btco/solutions/flower_shop.html">
        Part 1
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/psae-btco/assets/js/app.d63afb61.js" defer></script><script src="/psae-btco/assets/js/2.3969ddc5.js" defer></script><script src="/psae-btco/assets/js/28.0a0cdb1a.js" defer></script>
  </body>
</html>
